@use '@/styles' as theme;

.scrollContainer {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: auto;
  display: flex;
  // Disable ALL native touch gestures - we handle 2-finger pan via JavaScript
  // This prevents 1-finger scrolling outside canvas and ensures consistent behavior
  touch-action: none;

  // Move vertical scrollbar to the left side consistently in both LTR and RTL modes
  // In LTR documents: direction: rtl puts scrollbar on left
  // In RTL documents: direction: ltr puts scrollbar on left (opposite of document direction)
  direction: rtl;

  :global([dir='rtl']) & {
    // In RTL mode, use LTR to place scrollbar on the visual left side
    direction: ltr;
  }

  // Move horizontal scrollbar from bottom to top using vertical flip
  // The container is flipped, and the content is counter-flipped to appear normal
  // This works independently of LTR/RTL (which is horizontal, not vertical)
  transform: scaleY(-1);

  // Custom scrollbar with user preference color track and gray thumb
  scrollbar-width: auto;
  scrollbar-color: rgba(120, 120, 128, 0.6) var(--user-chosen-color, var(--glass-background));

  &::-webkit-scrollbar {
    width: theme.$spacing-3;
    height: theme.$spacing-3;
  }

  &::-webkit-scrollbar-track {
    @include theme.glass-background;
    border: 1px solid rgba(120, 120, 128, 0.3);
    @include theme.rounded-medium;
  }

  &::-webkit-scrollbar-thumb {
    background: rgba(120, 120, 128, 0.5);
    border: 1px solid rgba(120, 120, 128, 0.3);
    @include theme.rounded-medium;

    &:hover {
      background: rgba(120, 120, 128, 0.7);
    }

    &:active {
      background: rgba(120, 120, 128, 0.8);
    }
  }

  &::-webkit-scrollbar-corner {
    @include theme.glass-background;
  }
}

.canvasContainer {
  @include theme.flex-center;
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  position: relative;
  background: transparent;
  // Restore LTR direction for content (parent uses RTL for left-side scrollbar)
  direction: ltr;
  // Counter-flip the content so it appears right-side up
  // (parent scrollContainer is flipped to move horizontal scrollbar to top)
  transform: scaleY(-1);
}

.canvasContainer.hideBackground {
  background: transparent !important;
  background-image: none !important;
}

.canvasWrapper {
  position: relative;
  display: inline-block;
  transform-origin: center center;
  @include theme.shadow-heavy;
  @include theme.rounded-small;
  overflow: hidden;
}

.canvas {
  display: block;
  cursor: crosshair;
  border-radius: theme.$border-radius-xs;
  // Disable native touch gestures - all touch interactions handled via JavaScript
  // Single finger draws, two fingers pan (handled in useCanvasPanning)
  touch-action: none;
}

.canvas.disabled {
  cursor: not-allowed !important;
  opacity: 0.6;
  filter: grayscale(0.3);
}

/* Pseudo-element overlay for disconnected state with customizable content via CSS variable */
.scrollContainer.disconnected::after {
  content: var(--drawing-disabled-text, 'Drawing disabled - No connection to server');
  position: absolute;
  top: 50%;
  left: 50%;
  // Counter-flip the overlay text and apply centering translation
  // scaleY(-1) counters the parent's flip, translate centers the element
  transform: translate(-50%, -50%) scaleY(-1);
  background: theme.$error-overlay;
  color: theme.$text-primary;
  padding: theme.$spacing-3 theme.$spacing-5;
  @include theme.rounded-medium;
  font-size: theme.$font-size-sm;
  font-weight: 500;
  pointer-events: none;
  z-index: theme.$z-index-elevated;
  @include theme.shadow-medium;
}

.loadingOverlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: theme.$background-overlay;
  @include theme.flex-center;
  z-index: theme.$z-index-elevated;
  // Counter-flip the loading overlay so it appears right-side up
  // (parent scrollContainer is flipped to move horizontal scrollbar to top)
  transform: scaleY(-1);
}

.placeholderContent {
  @include theme.flex-column;
  @include theme.flex-center;
  gap: theme.$spacing-4;
}

.placeholderSpinner {
  width: 40px;
  height: 40px;
  border: 3px solid theme.$border-primary;
  border-top: 3px solid theme.$primary;
  @include theme.rounded-circle;
  animation: spin theme.$transition-very-slow linear infinite;
}

.placeholderText {
  color: theme.$text-muted;
  font-size: theme.$font-size-sm;
  margin: 0;
  font-weight: 500;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

@use '@/styles' as theme;

// =============================================================================
// MODAL COMPONENT STYLES
// =============================================================================
// NOTE ON !important USAGE:
// The overlay and backdrop use !important for positioning properties to ensure
// the modal always displays correctly regardless of:
// 1. Framer Motion inline styles that may override positioning
// 2. Parent component contexts that might affect fixed positioning
// 3. Third-party library interference
// These are defensive styles critical for modal functionality.
// =============================================================================

// --- Modal Layout ---

// Full-screen modal overlay container
// !important: Required to override Framer Motion inline styles and ensure
// consistent positioning across all contexts where the modal might be rendered
.overlay {
  @include theme.fixed-overlay;
  @include theme.flex-center;
  background-color: transparent; // No background - backdrop handles it
  padding: theme.$spacing-0 theme.$spacing-4;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
  z-index: theme.$z-index-modal !important;
  // DO NOT add overflow-y: auto here - only content should scroll, not overlay
}

// Clickable backdrop behind modal content
// !important: Same reasoning as overlay - must maintain fixed full-screen positioning
.backdrop {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  background-color: theme.$overlay-strong;
  border: none;
  cursor: pointer;
  z-index: 0; // Behind the content
}

// Modal content container with responsive sizing
.content {
  @include theme.card-base;
  @include theme.rounded-medium;
  @include theme.shadow-heavy;
  @include theme.theme-scrollbar;
  background: var(--user-chosen-color, var(--glass-background));
  border: theme.$border-width solid var(--glass-border);
  min-width: theme.$modal-min-width;
  max-width: theme.$modal-max-width;
  max-height: 90vh;
  height: fit-content;
  position: relative;
  z-index: theme.$z-index-elevated;
  overflow-y: auto;
  margin: theme.$spacing-6 auto;
}

// Special override for wide modals (like create board form)
:global(.modal-wide) .content {
  max-width: 700px;
  width: 100%;
}

// Close button at top-right of modal content (scrolls with content)
.closeButton {
  position: absolute;
  top: theme.$spacing-5;
  inset-inline-end: theme.$spacing-2;
  z-index: theme.$z-index-elevated;
  background: var(--user-chosen-color, var(--glass-background));
  border: theme.$border-width solid theme.$border-strong;
  border-radius: theme.$border-radius-sm;
  padding: theme.$spacing-2;
  line-height: 1;
  min-width: 36px;
  min-height: 36px;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

// --- Responsive Design ---

// Tablet responsive adjustments
@media (max-width: theme.$breakpoint-md) {
  .overlay {
    padding: theme.$spacing-4 theme.$spacing-2;
  }

  .content {
    min-width: 280px;
    max-width: calc(100vw - theme.$spacing-4);
    max-height: calc(100vh - theme.$spacing-8);
    padding: theme.$spacing-6;
    margin: theme.$spacing-4 auto;
  }

  .closeButton {
    top: theme.$spacing-2;
    inset-inline-end: theme.$spacing-2;
  }
}

// Mobile responsive adjustments
@media (max-width: theme.$breakpoint-sm) {
  .overlay {
    padding: theme.$spacing-2;
    align-items: center;
    justify-content: center;
  }

  .content {
    min-width: 280px;
    width: calc(100vw - 32px);
    max-width: calc(100vw - 32px);
    max-height: calc(100vh - 32px);
    margin: 0;
    border-radius: theme.$border-radius-md;
    padding: theme.$spacing-4;
    overflow-y: auto;
  }

  .closeButton {
    top: theme.$spacing-2;
    inset-inline-end: theme.$spacing-2;
    min-width: 32px;
    min-height: 32px;
    width: 32px;
    height: 32px;
  }
}

// Full-screen modal variant for mobile (used by large forms like Create Board)
// !important: Required here because :global() selectors have lower specificity than
// the base .content styles above. These must override all base responsive styles
// to achieve true fullscreen behavior on mobile devices.
@media (max-width: theme.$breakpoint-sm) {
  :global(.modal-fullscreen-mobile) {
    padding: 0 !important;
    align-items: stretch !important;
    justify-content: stretch !important;
  }

  :global(.modal-fullscreen-mobile) .content {
    min-width: 0 !important;
    width: 100vw !important;
    max-width: 100vw !important;
    height: 100% !important;
    max-height: 100% !important;
    margin: 0 !important;
    border-radius: 0 !important;
    padding: theme.$spacing-4 !important;
    padding-top: theme.$spacing-12 !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    box-sizing: border-box !important;
  }
}
